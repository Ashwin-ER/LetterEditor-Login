<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Letter Editor - Login</title>
    <script src="main.js" defer type="module"></script>
    <link rel="stylesheet" href="styles.css">
    <!-- Google Sign-In API -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        :root {
            --primary-color: #4b6cb7;
            --primary-dark: #35548b;
            --secondary-color: #dc3545;
            --secondary-dark: #c82333;
            --background-color: #f8f9fa;
            --text-color: #333;
            --border-color: #ddd;
            --shadow-color: rgba(0, 0, 0, 0.1);
        }

        body {
            background: var(--background-color);
            color: var(--text-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .editor-section {
            display: none;
            max-width: 900px;
            margin: 2rem auto;
            padding: 2rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px var(--shadow-color);
        }

        .editor-toolbar {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            background: #f8f9fa;
            border-radius: 8px;
        }

        .editor-toolbar button {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            background: var(--primary-color);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .editor-toolbar button:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        .editor-toolbar button:active {
            transform: translateY(0);
        }

        .editor-content {
            min-height: 500px;
            padding: 2rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 1rem;
            outline: none;
            background: white;
            font-size: 1.1rem;
            line-height: 1.8;
        }

        .editor-content:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(75, 108, 183, 0.1);
        }

        .save-status {
            text-align: right;
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            min-height: 1.5rem;
        }

        .drive-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 1rem;
        }

        .drive-actions button {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 6px;
            background: var(--primary-color);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .drive-actions button:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        .drive-actions button:active {
            transform: translateY(0);
        }

        .drive-actions button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .user-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .user-info span {
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--text-color);
        }

        .logout-btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 6px;
            background: var(--secondary-color);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logout-btn:hover {
            background: var(--secondary-dark);
            transform: translateY(-1px);
        }

        .logout-btn:active {
            transform: translateY(0);
        }

        /* Form Styles */
        .form-box {
            max-width: 400px;
            margin: 2rem auto;
            padding: 2rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px var(--shadow-color);
        }

        .form-container {
            text-align: center;
        }

        .form-container h2 {
            color: var(--text-color);
            margin-bottom: 2rem;
            font-size: 1.8rem;
        }

        .input-group {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .input-group input {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(75, 108, 183, 0.1);
        }

        .input-group label {
            position: absolute;
            left: 0.8rem;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            transition: all 0.3s ease;
            pointer-events: none;
        }

        .input-group input:focus + label,
        .input-group input:not(:placeholder-shown) + label {
            top: 0;
            font-size: 0.8rem;
            background: white;
            padding: 0 0.4rem;
            color: var(--primary-color);
        }

        .divider {
            display: flex;
            align-items: center;
            text-align: center;
            margin: 1.5rem 0;
        }

        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid var(--border-color);
        }

        .divider span {
            padding: 0 1rem;
            color: #666;
            font-size: 0.9rem;
        }

        .google-btn {
            margin: 1rem 0;
        }

        .google-signin-btn {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: white;
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .google-signin-btn:hover {
            background: #f8f9fa;
            border-color: var(--primary-color);
        }

        .google-signin-btn img {
            width: 20px;
            height: 20px;
        }

        .links {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
        }

        .links a {
            color: var(--primary-color);
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.3s ease;
        }

        .links a:hover {
            color: var(--primary-dark);
        }

        /* Success and Error Messages */
        .success-message,
        .error-message {
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 6px;
            text-align: center;
            font-weight: 500;
            animation: slideIn 0.3s ease-out;
        }

        .success-message {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error-message {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .editor-section {
                padding: 1rem;
            }

            .editor-toolbar {
                flex-wrap: wrap;
            }

            .editor-toolbar button {
                flex: 1 1 calc(50% - 0.5rem);
            }

            .drive-actions {
                flex-direction: column;
            }

            .drive-actions button {
                width: 100%;
            }

            .form-box {
                margin: 1rem;
                padding: 1.5rem;
            }
        }

        /* Download Button Styles */
        .download-dropdown {
            position: relative;
            margin-left: auto;
        }

        .download-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .download-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        .download-btn:active {
            transform: translateY(0);
        }

        .dropdown-arrow {
            transition: transform 0.3s ease;
        }

        .download-dropdown.active .dropdown-arrow {
            transform: rotate(180deg);
        }

        .download-menu {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 0.5rem;
            background: white;
            border-radius: 6px;
            box-shadow: 0 4px 6px var(--shadow-color);
            display: none;
            min-width: 200px;
            z-index: 1000;
        }

        .download-dropdown.active .download-menu {
            display: block;
        }

        .download-menu button {
            width: 100%;
            padding: 0.8rem 1rem;
            border: none;
            background: none;
            color: var(--text-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            border-radius: 0;
            text-align: left;
        }

        .download-menu button:first-child {
            border-radius: 6px 6px 0 0;
        }

        .download-menu button:last-child {
            border-radius: 0 0 6px 6px;
        }

        .download-menu button:hover {
            background: #f8f9fa;
            color: var(--primary-color);
        }

        @media (max-width: 768px) {
            .download-dropdown {
                width: 100%;
                margin-top: 0.5rem;
            }

            .download-btn {
                width: 100%;
                justify-content: center;
            }

            .download-menu {
                width: 100%;
                position: static;
                margin-top: 0.5rem;
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login/Signup Forms -->
        <div class="form-box" id="authForms">
            <!-- Login Form -->
            <div class="form-container" id="loginForm">
                <h2>Welcome Back</h2>
                <form id="loginFormElement">
                    <div class="input-group">
                        <input type="email" id="loginEmail" required placeholder=" ">
                        <label for="loginEmail">Email</label>
                    </div>
                    <div class="input-group">
                        <input type="password" id="loginPassword" required placeholder=" ">
                        <label for="loginPassword">Password</label>
                    </div>
                    <button type="submit">Login</button>
                </form>
                <div class="divider">
                    <span>or</span>
                </div>
                <div class="google-btn">
                    <button id="google-login-btn" class="google-signin-btn">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" alt="Google Logo">
                        Sign in with Google
                    </button>
                </div>
                <div class="links">
                    <a href="#" id="forgotPassword">Forgot Password?</a>
                    <a href="#" id="showSignup">Don't have an account? Sign Up</a>
                </div>
            </div>

            <!-- Signup Form -->
            <div class="form-container" id="signupForm" style="display: none;">
                <h2>Create Account</h2>
                <form id="signupFormElement">
                    <div class="input-group">
                        <input type="text" id="signupName" required placeholder=" ">
                        <label for="signupName">Full Name</label>
                    </div>
                    <div class="input-group">
                        <input type="email" id="signupEmail" required placeholder=" ">
                        <label for="signupEmail">Email</label>
                    </div>
                    <div class="input-group">
                        <input type="password" id="signupPassword" required placeholder=" ">
                        <label for="signupPassword">Password</label>
                    </div>
                    <div class="input-group">
                        <input type="password" id="confirmPassword" required placeholder=" ">
                        <label for="confirmPassword">Confirm Password</label>
                    </div>
                    <button type="submit">Sign Up</button>
                </form>
                <div class="divider">
                    <span>or</span>
                </div>
                <div class="google-btn">
                    <button id="google-login-btn" class="google-signin-btn">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" alt="Google Logo">
                        Sign in with Google
                    </button>
                </div>
                <div class="links">
                    <a href="#" id="showLogin">Already have an account? Login</a>
                </div>
            </div>
        </div>

        <!-- Letter Editor Section -->
        <div class="editor-section" id="editorSection">
            <div class="user-info">
                <span id="userName">Welcome, User!</span>
                <button class="logout-btn" onclick="logout()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M12 1a1 1 0 0 1 1 1v13h1.5a.5.5 0 0 1 0 1h-13a.5.5 0 0 1 0-1H3V2a1 1 0 0 1 1-1h8zm-2 9a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>
                    </svg>
                    Logout
                </button>
            </div>
            <div class="editor-toolbar">
                <button onclick="formatText('bold')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8.21 13c2.106 0 3.412-1.087 3.412-2.823 0-1.306-.984-2.283-2.324-2.386v-.055a2.176 2.176 0 0 0 1.852-2.14c0-1.51-1.162-2.46-3.014-2.46H3.843V13H8.21zM5.908 4.674h1.696c.963 0 1.517.451 1.517 1.244 0 .834-.629 1.32-1.73 1.32H5.908V4.674zm0 6.072V6.227h2.005c1.108 0 1.67.486 1.67 1.341 0 .872-.587 1.178-1.677 1.178H5.908z"/>
                    </svg>
                    Bold
                </button>
                <button onclick="formatText('italic')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M7.991 11.674 9.53 4.455c.123-.595.246-.71 1.347-.807l.11-.52H7.211l-.11.52c1.101.096 1.224.212 1.224.807l-.332.678h-.044l-2.319 5.678h2.47z"/>
                    </svg>
                    Italic
                </button>
                <button onclick="formatText('underline')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M5.313 3.136h-1.23V9.54c0 2.105 1.47 3.623 4.48 3.623s4.48-1.528 4.48-3.623V3.136h-1.23v6.323c0 1.49-.978 2.57-3.25 2.57-2.27 0-3.25-1.08-3.25-2.57V3.136zM12.5 15h-9v-1h9v1z"/>
                    </svg>
                    Underline
                </button>
                <button onclick="saveDraft()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M2 1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H2zm12 1a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h12z"/>
                        <path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8zm0 2.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm0 2.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1h-4a.5.5 0 0 1-.5-.5z"/>
                    </svg>
                    Save Draft
                </button>
                <div class="download-dropdown">
                    <button class="download-btn" onclick="toggleDownloadMenu()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                            <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
                        </svg>
                        Download
                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 16 16" class="dropdown-arrow">
                            <path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/>
                        </svg>
                    </button>
                    <div class="download-menu" id="downloadMenu">
                        <button onclick="downloadAsHTML()">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                            </svg>
                            Download as HTML
                        </button>
                        <button onclick="downloadAsPDF()">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                                <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
                            </svg>
                            Download as PDF
                        </button>
                    </div>
                </div>
            </div>
            <div id="editor" class="editor-content" contenteditable="true"></div>
            <div class="save-status" id="saveStatus"></div>
            <div class="drive-actions">
                <button onclick="saveToDrive()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                        <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
                    </svg>
                    Save to Drive
                </button>
                <button onclick="loadFromDrive()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                        <path d="M7.646 15.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 14.293V5.5a.5.5 0 0 0-1 0v8.793l-2.146-2.147a.5.5 0 0 0-.708.708l3 3z"/>
                    </svg>
                    Load from Drive
                </button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script src="letter-editor.js"></script>
    <!-- Google API Scripts -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://apis.google.com/js/platform.js"></script>
    <script src="https://unpkg.com/jwt-decode/build/jwt-decode.js"></script>
    <!-- PDF Generation Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script>
        // Initialize Google Sign-In
        function handleCredentialResponse(response) {
            try {
                const responsePayload = jwt_decode(response.credential);
                const user = {
                    name: responsePayload.name,
                    email: responsePayload.email,
                    picture: responsePayload.picture
                };
                localStorage.setItem('currentUser', JSON.stringify(user));
                window.showEditor();
                
                // Initialize Google Drive after successful sign-in
                initializeGisClient();
            } catch (error) {
                console.error('Error handling Google Sign-In:', error);
                updateSaveStatus('Error signing in with Google');
            }
        }

        // Add Google Sign-In button to both forms
        document.addEventListener('DOMContentLoaded', () => {
            const googleButtons = document.querySelectorAll('.google-signin-btn');
            googleButtons.forEach(button => {
                button.addEventListener('click', () => {
                    google.accounts.id.prompt();
                });
            });
        });
    </script>
</body>
</html> 